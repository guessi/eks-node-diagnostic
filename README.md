# eks-node-diagnostic

[![GitHub Actions](https://github.com/guessi/eks-node-diagnostic/actions/workflows/go.yml/badge.svg?branch=master)](https://github.com/guessi/eks-node-diagnostic/actions/workflows/go.yml)
[![GoDoc](https://godoc.org/github.com/guessi/eks-node-diagnostic?status.svg)](https://godoc.org/github.com/guessi/eks-node-diagnostic)
[![Go Report Card](https://goreportcard.com/badge/github.com/guessi/eks-node-diagnostic)](https://goreportcard.com/report/github.com/guessi/eks-node-diagnostic)
[![GitHub release](https://img.shields.io/github/release/guessi/eks-node-diagnostic.svg)](https://github.com/guessi/eks-node-diagnostic/releases/latest)
[![GitHub go.mod Go version](https://img.shields.io/github/go-mod/go-version/guessi/eks-node-diagnostic)](https://github.com/guessi/eks-node-diagnostic/blob/master/go.mod)

Friendly `NodeDiagnostic` generator with no Python/SDK required

## üî¢ Prerequisites

* An existing Amazon EKS cluster with the node monitoring agent.
* An existing Amazon S3 bucket for storing node logs generated by `NodeDiagnostic`.
* An IAM Role/User with `s3:PutObject` permission (to generate presigned S3 url).

## üëÄ Key differences with [official guidance](https://docs.aws.amazon.com/eks/latest/userguide/auto-get-logs.html)

* Single executable binary only, no Python and no AWS SDK required.
* Run anywhere, compatible with Linux, Windows, macOS (both `amd64` and `arm64`).
* Friendly setup with [Homebrew](https://brew.sh/) for mac users.

## üöÄ Usage

```bash
$ eks-node-diagnostic --help
```

```bash
$ eks-node-diagnostic -r ${REGION_NAME} -n ${NODE_NAME} -b ${BUCKET_NAME} > ./NodeDiagnostic.yaml

$ kubectl apply -f ./NodeDiagnostic.yaml
nodediagnostic.eks.amazonaws.com/i-EXAMPLE created
```

## :accessibility: FAQ

Q1: Where can I find log archive generated by `NodeDiagnostic`?

A1: Log archive generated by `NodeDiagnostic` would be placed under the bucket that you specified, with path below,
> `s3://{{ BUCKET_NAME }}/node-diagnostic/log__{{ REGION }}__{{ NODE_NAME }}__{{ TIMESTAMP }}.tar.gz`

Q2: How do I report an issue or submit a feature request?

A2: Please go for project's [issue page](https://github.com/guessi/eks-node-diagnostic/issues) and describe your idea in detail.

## ‚öôÔ∏è Install

### Homebrew

```bash
brew tap guessi/tap && brew update && brew install eks-node-diagnostic
```

### For non-Homebrew users

<details><!-- markdownlint-disable-line -->
<summary>Click to expand!</summary><!-- markdownlint-disable-line -->

### For Linux users

```bash
curl -fsSL https://github.com/guessi/eks-node-diagnostic/releases/latest/download/eks-node-diagnostic-Linux-$(uname -m).tar.gz -o - | tar zxvf -
mv -vf ./eks-node-diagnostic /usr/local/bin/eks-node-diagnostic
```

### For macOS users

```bash
curl -fsSL https://github.com/guessi/eks-node-diagnostic/releases/latest/download/eks-node-diagnostic-Darwin-$(uname -m).tar.gz -o - | tar zxvf -
mv -vf ./eks-node-diagnostic /usr/local/bin/eks-node-diagnostic
```

### For Windows users

```powershell
$SRC = 'https://github.com/guessi/eks-node-diagnostic/releases/latest/download/eks-node-diagnostic-Windows-x86_64.tar.gz'
$DST = 'C:\Temp\eks-node-diagnostic-Windows-x86_64.tar.gz'
Invoke-RestMethod -Uri $SRC -OutFile $DST
```

</details>

## License

[Apache-2.0](LICENSE)
